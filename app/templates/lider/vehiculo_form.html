{% extends "base.html" %}

{% block title %}{{ titulo }} - Synapsis Apoyos{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">
                        <i class="fas fa-car me-2"></i>{{ titulo }}
                    </h4>
                    <a href="{{ url_for('lider.vehiculos') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i>Volver
                    </a>
                </div>
                
                <div class="card-body">
                    <form method="POST" id="vehiculoForm">
                        <div class="row">
                            <!-- Información básica del vehículo -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">
                                    <i class="fas fa-info-circle me-2"></i>Información Básica
                                </h5>
                                
                                <div class="mb-3">
                                    <label for="placa" class="form-label">Placa <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="placa" name="placa" 
                                           value="{{ vehiculo.placa if vehiculo else '' }}" 
                                           placeholder="Ej: ABC123" maxlength="10" required>
                                    <div class="form-text">Ingrese la placa del vehículo (se convertirá a mayúsculas automáticamente)</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="marca" class="form-label">Marca <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="marca" name="marca" 
                                           value="{{ vehiculo.marca if vehiculo else '' }}" 
                                           placeholder="Ej: Toyota, Honda, Yamaha" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="modelo" class="form-label">Modelo <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="modelo" name="modelo" 
                                           value="{{ vehiculo.modelo if vehiculo else '' }}" 
                                           placeholder="Ej: Corolla, Civic, YBR" required>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="año" class="form-label">Año <span class="text-danger">*</span></label>
                                            <input type="number" class="form-control" id="año" name="año" 
                                                   value="{{ vehiculo.año if vehiculo else '' }}" 
                                                   min="1990" max="2030" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="color" class="form-label">Color <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="color" name="color" 
                                                   value="{{ vehiculo.color if vehiculo else '' }}" 
                                                   placeholder="Ej: Blanco, Negro, Azul" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="tipo_vehiculo" class="form-label">Tipo de Vehículo <span class="text-danger">*</span></label>
                                            <select class="form-select" id="tipo_vehiculo" name="tipo_vehiculo" required>
                                                <option value="">Seleccione...</option>
                                                <option value="moto" {{ 'selected' if vehiculo and vehiculo.tipo_vehiculo == 'moto' }}>Moto</option>
                                                <option value="carro" {{ 'selected' if vehiculo and vehiculo.tipo_vehiculo == 'carro' }}>Carro</option>
                                                <option value="camioneta" {{ 'selected' if vehiculo and vehiculo.tipo_vehiculo == 'camioneta' }}>Camioneta</option>
                                                <option value="furgon" {{ 'selected' if vehiculo and vehiculo.tipo_vehiculo == 'furgon' }}>Furgón</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="combustible" class="form-label">Combustible <span class="text-danger">*</span></label>
                                            <select class="form-select" id="combustible" name="combustible" required>
                                                <option value="">Seleccione...</option>
                                                <option value="gasolina" {{ 'selected' if vehiculo and vehiculo.combustible == 'gasolina' }}>Gasolina</option>
                                                <option value="diesel" {{ 'selected' if vehiculo and vehiculo.combustible == 'diesel' }}>Diésel</option>
                                                <option value="electrico" {{ 'selected' if vehiculo and vehiculo.combustible == 'electrico' }}>Eléctrico</option>
                                                <option value="hibrido" {{ 'selected' if vehiculo and vehiculo.combustible == 'hibrido' }}>Híbrido</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Información técnica y asignación -->
                            <div class="col-md-6">
                                <h5 class="mb-3 text-primary">
                                    <i class="fas fa-cogs me-2"></i>Información Técnica
                                </h5>
                                
                                <div class="mb-3">
                                    <label for="numero_motor" class="form-label">Número de Motor</label>
                                    <input type="text" class="form-control" id="numero_motor" name="numero_motor" 
                                           value="{{ vehiculo.numero_motor if vehiculo and vehiculo.numero_motor else '' }}" 
                                           placeholder="Opcional">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="numero_chasis" class="form-label">Número de Chasis</label>
                                    <input type="text" class="form-control" id="numero_chasis" name="numero_chasis" 
                                           value="{{ vehiculo.numero_chasis if vehiculo and vehiculo.numero_chasis else '' }}" 
                                           placeholder="Opcional">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="cilindraje" class="form-label">Cilindraje</label>
                                    <input type="text" class="form-control" id="cilindraje" name="cilindraje" 
                                           value="{{ vehiculo.cilindraje if vehiculo and vehiculo.cilindraje else '' }}" 
                                           placeholder="Ej: 125cc, 1.6L">
                                </div>
                                
                                <h5 class="mb-3 text-primary mt-4">
                                    <i class="fas fa-user me-2"></i>Asignación de Móvil
                                </h5>
                                
                                <div class="mb-3">
                                    <label for="movil_id" class="form-label">Móvil Asignado</label>
                                    <select class="form-select" id="movil_id" name="movil_id">
                                        <option value="">Sin asignar</option>
                                        {% for movil in moviles_disponibles %}
                                        <option value="{{ movil.id }}" 
                                                {{ 'selected' if vehiculo and vehiculo.movil_id == movil.id }}>
                                            {{ movil.get_nombre_completo() }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                    <div class="form-text">Seleccione el móvil que utilizará este vehículo</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="observaciones" class="form-label">Observaciones</label>
                                    <textarea class="form-control" id="observaciones" name="observaciones" 
                                              rows="4" placeholder="Observaciones adicionales sobre el vehículo...">{{ vehiculo.observaciones if vehiculo and vehiculo.observaciones else '' }}</textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Botones de acción -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <a href="{{ url_for('lider.vehiculos') }}" class="btn btn-secondary">
                                        <i class="fas fa-times me-1"></i>Cancelar
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i>
                                        {% if vehiculo %}Actualizar{% else %}Crear{% endif %} Vehículo
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Convertir placa a mayúsculas automáticamente
    const placaInput = document.getElementById('placa');
    placaInput.addEventListener('input', function() {
        this.value = this.value.toUpperCase();
    });
    
    // Validación del formulario
    const form = document.getElementById('vehiculoForm');
    form.addEventListener('submit', function(e) {
        const año = parseInt(document.getElementById('año').value);
        const currentYear = new Date().getFullYear();
        
        if (año < 1990 || año > currentYear + 5) {
            e.preventDefault();
            alert('El año del vehículo debe estar entre 1990 y ' + (currentYear + 5));
            return false;
        }
        
        // Validar que la placa tenga al menos 6 caracteres
        const placa = document.getElementById('placa').value.trim();
        if (placa.length < 6) {
            e.preventDefault();
            alert('La placa debe tener al menos 6 caracteres');
            return false;
        }
    });
    
    // Mostrar/ocultar campos según el tipo de vehículo
    const tipoVehiculo = document.getElementById('tipo_vehiculo');
    const cilindrajeGroup = document.getElementById('cilindraje').closest('.mb-3');
    
    function toggleCilindraje() {
        if (tipoVehiculo.value === 'moto') {
            cilindrajeGroup.style.display = 'block';
            document.getElementById('cilindraje').placeholder = 'Ej: 125cc, 150cc, 200cc';
        } else if (tipoVehiculo.value === 'carro' || tipoVehiculo.value === 'camioneta' || tipoVehiculo.value === 'furgon') {
            cilindrajeGroup.style.display = 'block';
            document.getElementById('cilindraje').placeholder = 'Ej: 1.6L, 2.0L, 2.4L';
        } else {
            cilindrajeGroup.style.display = 'none';
        }
    }
    
    tipoVehiculo.addEventListener('change', toggleCilindraje);
    toggleCilindraje(); // Ejecutar al cargar la página
});
</script>
{% endblock %}